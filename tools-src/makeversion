#!/bin/sh

# Copyright (C) 2000, 2001, 2002, 2003, 2004, 2005
# Free Software Foundation, Inc.
# This file is part of GNU Modula-2.
#
# GNU Modula-2 is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
# 
# GNU Modula-2 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with GNU Modula-2; see the file COPYING.  If not, write to the
# Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA. 
#


#
# makeversion a script which creates M2Version implementation
#             module for the GNU Modula-2 compiler
#

GuessMailAdr()
{
  user=`logname`
  host=`hostname`
  if   [ ! `expr $host : '.*[.]'` -gt 0 ]
  then if   [ -f /etc/hosts ]
       then qhost=`cut -d'#' -f1 /etc/hosts | grep $host. | head -1`
	    set -- $qhost
	    shift
	    while [ -n "$1" ] && [ `expr $1 : '.*[.]'` -eq 0 ];
	    do shift
	    done
	    [ -n "$1" ] && mail="$user@$1"
       fi
  fi
  [ -z "$mail" ] && mail="$user@$host"
}

/bin/rm -f M2Version.mod

param=$1    # command line arguments may get lost because of func call
GuessMailAdr

cat << EOFEOF >> M2Version.mod
IMPLEMENTATION MODULE M2Version ;

FROM StrIO IMPORT WriteString ;


(* Generated by makeversion - do not edit *)

(*
   WriteVersion - writes the current version of the compiler
*)

PROCEDURE WriteVersion ;
BEGIN
EOFEOF
echo "    WriteString('$param ($mail)') ;" >> M2Version.mod
cat << EOFEOFEOF >> M2Version.mod
END WriteVersion ;


END M2Version.
EOFEOFEOF
