#!/bin/sh

#
# makeversion a script which creates M2Version implementation
#             module for the GNU Modula-2 compiler
#

GuessMailAdr()
{
  user=`logname`
  host=`hostname`
  if   [ ! `expr $host : '.*[.]'` -gt 0 ]
  then if   [ -f /etc/hosts ]
       then qhost=`cut -d'#' -f1 /etc/hosts | grep $host. | head -1`
	    set -- $qhost
	    shift
	    while [ -n "$1" ] && [ `expr $1 : '.*[.]'` -eq 0 ];
	    do shift
	    done
	    [ -n "$1" ] && mail="$user@$1"
       fi
  fi
  [ -z "$mail" ] && mail="$user@$host"
}

/bin/rm -f M2Version.mod

param=$1    # command line arguments may get lost because of func call
GuessMailAdr

cat << EOFEOF >> M2Version.mod
IMPLEMENTATION MODULE M2Version ;

FROM StrIO IMPORT WriteString ;


(* Generated by makeversion - do not edit *)

(*
   WriteVersion - writes the current version of the compiler
*)

PROCEDURE WriteVersion ;
BEGIN
EOFEOF
echo "    WriteString('$param ($mail)') ;" >> M2Version.mod
cat << EOFEOFEOF >> M2Version.mod
END WriteVersion ;


END M2Version.
EOFEOFEOF
