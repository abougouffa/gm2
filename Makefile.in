# Makefile for GNU Modula-2 compiler.
#   Copyright (C) 1987, 1988, 1990, 1991, 1992, 1993, 1994, 1998,
#   1999 Free Software Foundation, Inc.

# This file is part of GNU Modula-2.

# GNU Modula-2 is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.

# GNU Modula-2 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with GNU CC; see the file COPYING.  If not, write to
# the Free Software Foundation, 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.  */

# The makefile built from this file lives in the language subdirectory.
# It's purpose is to provide support for:
#
# 1) recursion where necessary, and only then (building .o's), and
# 2) building and debugging cc1 from the language subdirectory, and
# 3) nothing else.
#
# The parent makefile handles all other chores, with help from the
# language makefile fragment, of course.
#
# The targets for external use are:
# all, TAGS, ???mostlyclean, ???clean.

all:

clean: force
	-rm -f *.o *.html *.ps *.dvi *.log *.aux *.info *.ps *.aux *~
	-rm -f gm2l gm2lcc gm2lgen gm2lsub linkcommand mod_init.c
	( cd p2c/p2c-src ; $(MAKE) "QUIAT=$(QUIAT)" clean )
	-rm -f gm2-libs-boot/*.[aoch] gm2-compiler-boot/*.[aoch] gm2-libs/*.[oa] gm2-compiler/*.[oa] */*~ *~
	-rm -f gm2-libs-paranoid/*  gm2-compiler-paranoid/*
	-rm -f gm2-compiler-verify/*
	-rm -f gm2-compiler/mod_init.c
	-rm -f *.lst $(basename $(GM2-TOOLS-MOD)) gm2m
	-rm -f -r boot-bin p2c/p2c-src/home
	-rm -f boot-bin/mklink
	-rm -f pg-e pge
	-rm -f gm2-auto/*.c gm2-auto/*~ gm2-auto/pginit
	-rm -f gm2-libiberty/*.h gm2-libiberty/*~
	-rm -f gm2-auto/pg.o
	-rm -f gm2.cp gm2.fn gm2.pg gm2.toc gm2.tp gm2.vr gm2.ky
	-rm -f gm2-compiler/M2Version.mod

distclean: clean force
	-rm -f p2c/p2c-src/examples/Makefile
	-rm -f Makefile p2c/p2c-src/Makefile p2c/Makefile

maintainer-clean: force
	-rm -f gm2-auto/*

DISTFILES = CVS ChangeLog Make-lang.in Makefile.in README bnf config-lang.in \
            el gccgdbinit gccgm2.c gccgm2.def gm2-auto gm2-compiler gm2-compiler-boot \
            gm2-gccinit gm2-libs gm2-libs-boot gm2-libs-ch gm2.texi gm2spec.c \
            lang-options.h lang-specs.h loc.p2crc m2 m2.lex m2f-src p2c p2crc \
            tools-src gm2-libiberty

#
# remember distclean removes the Makefile
#

dist: distclean
	echo gm2-`date '+%Y%m%d'` > .fname
	-rm -rf `cat .fname`
	mkdir `cat .fname`
	dst=`cat .fname`; for f in $(DISTFILES); do \
           cp -pr $(srcdir)/$$f $$dst/$$f ; \
        done
	tar --gzip -chf `cat .fname`.tar.gz `cat .fname`
	-rm -rf `cat .fname` .fname

force:
